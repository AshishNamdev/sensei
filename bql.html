---
layout: default
title: SenseiDB - BQL
---
<div class="hero-unit">
  <h2>Browse Query Language (BQL)</h2>
  <p>The query lanaguage for Sensei</p>
</div>

<h2>What is it?</h2>
<p>
BQL is a SQL-like language that provides Sensei users easy access to the database if they have experience using traditional relational databases.
</p>

<h2>BQL Statement Syntax</h2>

<h4>DESCRIBE Statement</h4>
<p>
>DESCRIBE statement provides the information about the index
      (or table in RDBM terminology).  In Sensei, the index name is
      optional because when a Sensei client talks to one Sensei broker,
      only one index is accessible on this broker.  Essentially, the
      index name in a DESCRIBE statement is ignored.
</p>
<p><strong>Example:</strong></p>
<pre class="prettyprint">
  DESCRIBE
</pre>
<p><strong>Results:</strong></p>
<pre class="prettyprint">
+------------+------------+---------+-----------+-------------+---------+
| facet_name | facet_type | runtime | column    | column_type | depends |
+------------+------------+---------+-----------+-------------+---------+
| category   | simple     | false   | category  | string      | []      |
| groupid    | simple     | false   | groupid   | long        | []      |
| city       | path       | false   | city      | string      | []      |
| color      | simple     | false   | color     | string      | []      |
| tags       | multi      | false   | tags      | string      | []      |
| price      | range      | false   | price     | float       | []      |
| makemodel  | path       | false   | makemodel | string      | []      |
| mileage    | range      | false   | mileage   | int         | []      |
| year       | range      | false   | year      | int         | []      |
+------------+------------+---------+-----------+-------------+---------+
</pre>


<h4>SELECT Statement</h4>

<h5>Select List</h5>
<p>
The select list in a SELECT statement can simply be a
        <code>*</code>, which means all columns are
        selected.
</p>

<p>If the select list is not a <code>*</code>, each
        item, often called a <code>column</code>, in the select
        list is either a facet name or a field name in the index.  If a
        column is unknown to Sensei server, then <code>&lt;NOT
        FOUND&gt;</code> is displayed in the results.</p>

<h5>FROM Clause</h5>

 <p>Just like the index name in a DESCRIBE statement is
        optional, the FROM clause in a SELECT statement is also
        optional.</p>

<h5>WHERE Clause</h5>
<p>The WHERE clause, if given, specifies the search condition
        or conditions that documents must satisfy to be selected. Each
        condition is a Boolean expression consisting of one or more
        predicates.  Current the following predicates are supported in
        BQL:</p>
<ul>
<li>
  <p><strong>IN predicate</strong></p>
  <p>This predicate is used to specify the values of one
            column in search results.  For example:</p>
   <ul>
      <li><code>color IN ("red", "blue")</code></li>
      <li><code>category IN ("sedan", "compact")</code></li>
      <li><code>age in (10, 20, 30)</code></li>
   </ul>
</li>
<li>
  <p><strong>CONTAINS ALL predicate</strong></p>
  <p>
  This predicate is used to specify that a multi-value
            column has to contain <code>all</code> the
            values.  For example:
  </p>
  <ul>
  <li><code>tags CONTAINS ALL ("cool", "hybrid") EXCEPT("favorite")</code></li>
  </ul>
</li>
<li>
  <p><strong>EQUAL predicate</strong></p>
  <p>This predicate is used to specify a single value that
            a column needs to contain.  For example:</p>

  <ul>
  <li><code>color = "red"</code></li>
  </ul>
</li>
<li>
  <p><strong>NOT EQUAL predicate</strong></p>
  <p>TThis predicate is used to specify a single value that
            a column cannot contain.  For example:</p>

  <ul>
  <li><code>color &lt;&gt; "red"</code></li>
  </ul>
</li>
<li>
  <p><strong>QUERY predicate</strong></p>
  <p>This is used to do full text search on the internal
            <code>contents</code> column.  All Lucene query
            syntax is supported.  For example:</p>
    <ul>
  <li><code>QUERY IS "hybrid AND (cool or moon-roof)"</code></li>
  </ul>
</li>
<li>
  <p><strong>RANGE predicate</strong></p>
  <p>This predicate is used to specify a value range for a
            range facet.  For example:</p>
    <ul>
  <li><code>year &gt; 1999</code></li>
  <li><code>year &lt;= 2002</code></li>
  <li><code>price &lt; 17500</code></li>
  <li><code>time &gt;= "2011-10-20 15:30:00"</code></li>
  <li><code>time &lt; "2011/12/31 10:00:00"</code></li>
  </ul>
</li>
<li>
  <p><strong>BETWEEN predicate</strong></p>
  <p>This predicate is used to specify both the lower and
            upper bounds for a range facet at the same time. For
            example:</p>
    <ul>
  <li><code>year BETWEEN 1995 AND 2000</code></li>
  <p>Note that, when a BETWEEN predicate is used, both
              lower and upper bounds are included in the range
              selection.</p>
  </ul>
</li>
<li>
  <p><strong>TIME predicate</strong></p>
  <p>This predicate is used to specify a value range for a
            range facet.  For example:</p>
    <ul>
  <li><code>year &gt; 1999</code></li>
  <li><code>year &lt;= 2002</code></li>
  <li><code>price &lt; 17500</code></li>
  <li><code>time &gt;= "2011-10-20 15:30:00"</code></li>
  <li><code>time &lt; "2011/12/31 10:00:00"</code></li>
  </ul>
</li>
<li>
  <p><strong>MATCH AGAINST predicate</strong></p>
  <p>This predicate is used to perform full text searches
            on one or more columns that have a string data type.  When
            more than one columns are given in the predicate, then any
            column in the list that contains specified searched string
            would make a document satisfy this condition.  For example:</p>
    <ul>
  <li><code>MATCH(color) AGAINST("bl*")</code>
     <p>All cars that have a "black" or "blue" color would
                satisfy this predicate.</p>
  </li>
  <li><code>MATCH(category) AGAINST("*van")</code>
     <p>All cars in the category of "van" or "mini-van"
                would satisfy this predicate.</p>
  </li>
  <li><code>MATCH(color, category) AGAINST("*ac*")</code>
  <p>A car with a "black" or "blue" color, or with a
                category of "compact" would satisfy this
                condition.</p>
  </li>
  </ul>
</li>
<li>
  <p><strong>LIKE predicate</strong></p>
  <p>This is a predicate to do wildcard text match.  Two
            wildcards are supported: <code>%</code> and
            <code>_</code>.  Wildcard <code>%</code> matches
            zero or more characters, while <code>_</code> matches
            exactly one character.  For example:</p>
    <ul>
  <li><code>color LIKE "bl%"</code>
    <p>
All cars that have a "black" or "blue" color would
                satisfy this predicate.
    </p>
  </li>
  <li><code>color LIKE "bl__"</code>
    <p>All cars with a "blue" color would satisfy this
                condition, but the cars with a "black" color would
                not.</p>
  </li>
  </ul>
  <p>Note that wildcards <code>%</code> and
              <code>_</code>, not Lucene's <code>*</code>
              and <code>?</code> are used in BQL.  This is mainly
              to make BQL more compatible with SQL.  However, if
              <code>*</code> or <code>?</code> is used, it
              is also accepted.</p>
</li>
</ul>


<h5>GROUP BY Clause</h5>


<h5>BROWSE BY Clause</h5>


<h5>GIVEN FACET PARAM Clause</h5>


<h5>FETCHING STORED Clause</h5>

<h2>Examples</h2>

<h4>Basic Query</h4>
<p>Find the first 10 cars in the index:</p>
<pre class="prettyprint lang-bql">
SELECT * FROM cars;
</pre>
<p>This query searches for the top 10 cars, sorted by time,
      from index cars.  All columns are selected.  Number 10 is the
      default number of results to be returned, and time is the default
      order-by column.</p>

<p>Results:</p>
<pre class="prettyprint">
+---------------+---------------------------------+ ... +-------+
| category      | city                            |     | uid   |
+---------------+---------------------------------+ ... +-------+
| station wagon | u.s.a./florida/tampa            |     | 14999 |
| compact       | u.s.a./florida/tampa            |     | 0     |
| exotic        | u.s.a./florida/tampa            |     | 242   |
| compact       | u.s.a./texas/houston            |     | 1     |
| compact       | u.s.a./california/sunnyvale     |     | 241   |
| compact       | u.s.a./texas/houston            |     | 2     |
| exotic        | u.s.a./california/san francisco |     | 244   |
| compact       | u.s.a./california/san francisco |     | 243   |
| compact       | u.s.a./california/sacramento    |     | 3     |
| compact       | u.s.a./california/san diego     |     | 4     |
+---------------+---------------------------------+ ... +-------+
10 rows in set, 15000 hits, 15000 total docs (server: 20ms, total: 68ms)
</pre>

<h4>Queries with Limited Number of Results</h4>
<p>You can use the limit clause in a query to specify the
      starting offset and number of documents to be returned in the
      results. By default, the starting offset is 0, and number of
      results to be returned is 10. If only one number is specified in
      the limit clause, then it is treated the number of results.</p>

 <p>The limit clause is mainly used for pagination on search
      result age. In this example, we find the next 10 cars starting from offset 5:</p>

 <pre class="prettyprint lang-bql">
 SELECT * FROM cars LIMIT 5, 10
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+----------+---------------------------------+ ... +-----+
| category | city                            |     | uid |
+----------+---------------------------------+ ... +-----+
| compact  | u.s.a./texas/houston            |     | 2   |
| exotic   | u.s.a./california/san francisco |     | 244 |
| compact  | u.s.a./california/sacramento    |     | 3   |
| exotic   | china/beijing                   |     | 245 |
| compact  | u.s.a./california/san diego     |     | 4   |
| exotic   | u.s.a./new york/rochester       |     | 246 |
| compact  | china/shanghai                  |     | 5   |
| exotic   | u.s.a./new york/binghamton      |     | 247 |
| compact  | u.s.a./utah/salt lake city      |     | 6   |
| exotic   | china/shanghai                  |     | 248 |
+----------+---------------------------------+ ... +-----+
10 rows in set, 15000 hits, 15000 total docs (server: 10ms, total: 60ms)
</pre>

<h4>Queries with basic conditions</h4>
<p>Find all red cars:</p>
 <pre class="prettyprint lang-bql">
 SELECT color, year, makemodel FROM cars WHERE color = "red"
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+-------+----------------------+------------------------+
| color | year                 | makemodel              |
+-------+----------------------+------------------------+
| red   | 00000000000000001996 | european/bentley/azure |
| red   | 00000000000000001995 | european/bentley/azure |
| red   | 00000000000000002000 | european/bentley/azure |
| red   | 00000000000000001995 | european/bentley/azure |
| red   | 00000000000000001994 | european/bentley/azure |
| red   | 00000000000000001995 | asian/acura/3.2tl      |
| red   | 00000000000000001996 | asian/acura/3.2tl      |
| red   | 00000000000000001999 | european/bentley/azure |
| red   | 00000000000000002002 | european/bentley/azure |
| red   | 00000000000000001996 | asian/acura/integra    |
+-------+----------------------+------------------------+
10 rows in set, 2160 hits, 15000 total docs (server: 5ms, total: 41ms)
</pre>

<p>Find all red and blue cars:</p>
 <pre class="prettyprint lang-bql">
 SELECT color, year, makemodel FROM cars WHERE color IN ("red", "blue")
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+-------+----------------------+------------------------+
| color | year                 | makemodel              |
+-------+----------------------+------------------------+
| blue  | 00000000000000001999 | asian/acura/tl         |
| red   | 00000000000000001996 | european/bentley/azure |
| blue  | 00000000000000001998 | asian/acura/tl         |
| red   | 00000000000000001995 | european/bentley/azure |
| blue  | 00000000000000001995 | asian/acura/1.6el      |
| red   | 00000000000000002000 | european/bentley/azure |
| blue  | 00000000000000001993 | asian/acura/3.2tl      |
| blue  | 00000000000000001998 | asian/acura/tl         |
| red   | 00000000000000001995 | european/bentley/azure |
| red   | 00000000000000001994 | european/bentley/azure |
+-------+----------------------+------------------------+
10 rows in set, 3264 hits, 15000 total docs (server: 4ms, total: 33ms)
</pre>

<p>Find all 1999 or 2000 cars that are not black nor red:</p>
 <pre class="prettyprint lang-bql">
SELECT color, year, makemodel FROM cars WHERE color not in ("black", "red") AND year BETWEEN 1999 AND 2000
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+--------+----------------------+------------------------+
| color  | year                 | makemodel              |
+--------+----------------------+------------------------+
| blue   | 00000000000000001999 | asian/acura/tl         |
| white  | 00000000000000001999 | asian/acura/1.6el      |
| yellow | 00000000000000001999 | asian/acura/3.2tl      |
| silver | 00000000000000002000 | asian/acura/3.5rl      |
| silver | 00000000000000002000 | asian/acura/3.5rl      |
| yellow | 00000000000000002000 | asian/acura/integra    |
| yellow | 00000000000000002000 | asian/acura/integra    |
| yellow | 00000000000000002000 | european/bentley/azure |
| yellow | 00000000000000002000 | european/bentley/azure |
| yellow | 00000000000000002000 | asian/acura/tl         |
+--------+----------------------+------------------------+
10 rows in set, 1934 hits, 15000 total docs (server: 4ms, total: 35ms)
</pre>

<p>Find all cars in New York state:</p>
 <pre class="prettyprint lang-bql">
SELECT color, city, price FROM cars WHERE city in ("u.s.a./new york")
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+--------+----------------------------+-------------------------+
| color  | city                       | price                   |
+--------+----------------------------+-------------------------+
| white  | u.s.a./new york/albany     | 00000000000000007500.00 |
| red    | u.s.a./new york/rochester  | 00000000000000014500.00 |
| green  | u.s.a./new york/syracuse   | 00000000000000009500.00 |
| yellow | u.s.a./new york/binghamton | 00000000000000007200.00 |
| blue   | u.s.a./new york/new york   | 00000000000000009300.00 |
| yellow | u.s.a./new york/new york   | 00000000000000015400.00 |
| yellow | u.s.a./new york/new york   | 00000000000000015200.00 |
| black  | u.s.a./new york/albany     | 00000000000000009200.00 |
| gold   | u.s.a./new york/new york   | 00000000000000011100.00 |
| red    | u.s.a./new york/rochester  | 00000000000000009500.00 |
+--------+----------------------------+-------------------------+
10 rows in set, 2781 hits, 15000 total docs (server: 5ms, total: 37ms)
</pre>


<h4>Queries with AND, OR, and NOT Logic in Value Selections</h4>
<p>Find all cars tagged with
          both <code>"cool"</code> and <code>"hybrid"</code>
          but not <code>"favorite"</code>:</p>
 <pre class="prettyprint lang-bql">
SELECT tags, price from cars WHERE tags CONTAINS ALL ("cool", "hybrid") EXCEPT("favorite") LIMIT 5
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+----------------------------------+-------------------------+
| tags                             | price                   |
+----------------------------------+-------------------------+
| automatic,cool,hybrid,reliable   | 00000000000000009400.00 |
| cool,hybrid,moon-roof,navigation | 00000000000000011500.00 |
| automatic,cool,hybrid,reliable   | 00000000000000006300.00 |
| cool,hybrid,moon-roof,reliable   | 00000000000000006500.00 |
| cool,hybrid,moon-roof,reliable   | 00000000000000007100.00 |
+----------------------------------+-------------------------+
5 rows in set, 491 hits, 15000 total docs (server: 9ms, total: 28ms)
</pre>

<p>Find all cars tagged with
          either <code>"cool"</code> or
          <code>"hybrid"</code> but not
          <code>"mp3"</code></p>
 <pre class="prettyprint lang-bql">
SELECT tags, price FROM cars WHERE tags IN ("cool", "hybrid") EXCEPT ("mp3") LIMIT 5
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+----------------------------------------------+-------------------------+
| tags                                         | price                   |
+----------------------------------------------+-------------------------+
| hybrid,leather,moon-roof,reliable            | 00000000000000007500.00 |
| automatic,chick magnet,cool,highend,reliable | 00000000000000014200.00 |
| cool,electric,favorite,navigation            | 00000000000000007300.00 |
| cool,electric,favorite,reliable              | 00000000000000007200.00 |
| automatic,hybrid,leather,reliable            | 00000000000000007100.00 |
+----------------------------------------------+-------------------------+
5 rows in set, 8176 hits, 15000 total docs (server: 6ms, total: 25ms)
</pre>

<h4>Having Search Results Sorted</h4>

<p>You can sort the search result based on one or more columns,
      in either ascending (the default) or descending order.</p>

<p>Find the top 5 cheapest
          but newest cars.</p>
<pre class="prettyprint lang-bql">
SELECT year, makemodel, price FROM cars ORDER BY year desc, price LIMIT 5
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+----------------------+-------------------------------+-------------------------+
| year                 | makemodel                     | price                   |
+----------------------+-------------------------------+-------------------------+
| 00000000000000002002 | asian/subaru/justy            | 00000000000000002100.00 |
| 00000000000000002002 | asian/subaru/justy            | 00000000000000002100.00 |
| 00000000000000002002 | north american/dodge/colt     | 00000000000000002400.00 |
| 00000000000000002002 | north american/mercury/tracer | 00000000000000002400.00 |
| 00000000000000002002 | north american/mercury/tracer | 00000000000000002500.00 |
+----------------------+-------------------------------+-------------------------+
5 rows in set, 15000 hits, 15000 total docs (server: 22ms, total: 50ms)
</pre>

<p>Find the top 5 most
          expensive but oldest cars:</p>
<pre class="prettyprint lang-bql">
SELECT year, makemodel, price FROM cars ORDER BY year asc, price desc LIMIT 5
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+----------------------+-----------------------------+-------------------------+
| year                 | makemodel                   | price                   |
+----------------------+-----------------------------+-------------------------+
| 00000000000000001993 | european/ferrari/360 modena | 00000000000000019500.00 |
| 00000000000000001993 | asian/acura/nsx             | 00000000000000019500.00 |
| 00000000000000001993 | european/aston martin/db7   | 00000000000000019500.00 |
| 00000000000000001993 | european/ferrari/360 modena | 00000000000000019500.00 |
| 00000000000000001993 | asian/acura/nsx             | 00000000000000019500.00 |
+----------------------+-----------------------------+-------------------------+
5 rows in set, 15000 hits, 15000 total docs (server: 5ms, total: 27ms)
</pre>

<h4>Queries with Full Text Search</h4>

<p>In the WHERE clause, you can add a condition for full text
      search, which is called a (text) query. This condition is to find
      the documents that contain matching text. You can use Lucene Query
      Syntax in the text string that you search on.</p>

<p>Find all the cars that are
          tagged with "hybrid" and "navigation":</p>
<pre class="prettyprint lang-bql">
SELECT tags, makemodel FROM cars WHERE QUERY IS "hybrid AND navigation"
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+-------------------------------------+----------------------------+
| tags                                | makemodel                  |
+-------------------------------------+----------------------------+
| hybrid,leather,moon-roof,navigation | asian/acura/tl             |
| favorite,hybrid,mp3,navigation      | asian/acura/tl             |
| favorite,hybrid,mp3,navigation      | asian/acura/3.2tl          |
| favorite,hybrid,mp3,navigation      | asian/acura/tl             |
| cool,hybrid,moon-roof,navigation    | asian/acura/tl             |
| cool,favorite,hybrid,navigation     | asian/acura/vigor          |
| automatic,cool,hybrid,navigation    | asian/acura/vigor          |
| cool,hybrid,moon-roof,navigation    | asian/acura/vigor          |
| cool,hybrid,moon-roof,navigation    | north american/asuna/se/gt |
| automatic,hybrid,leather,navigation | european/saab/900          |
+-------------------------------------+----------------------------+
10 rows in set, 778 hits, 15000 total docs (server: 186ms, total: 209ms)
</pre>

<p>A more complicated
          example:</p>

<pre class="prettyprint lang-bql">
SELECT color, tags, city FROM cars
                         WHERE QUERY IS "(hybrid OR mooon-roof) AND mp3 NOT cool NOT navigation"
                         AND city in ("u.s.a./new york")
                         AND color = "red"
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+-------+-------------------------------+----------------------------+
| color | tags                          | city                       |
+-------+-------------------------------+----------------------------+
| red   | automatic,hybrid,mp3,reliable | u.s.a./new york/new york   |
| red   | hybrid,moon-roof,mp3,reliable | u.s.a./new york/buffalo    |
| red   | favorite,hybrid,mp3,reliable  | u.s.a./new york/syracuse   |
| red   | favorite,hybrid,mp3,reliable  | u.s.a./new york/buffalo    |
| red   | automatic,hybrid,mp3,reliable | u.s.a./new york/syracuse   |
| red   | favorite,hybrid,mp3,reliable  | u.s.a./new york/binghamton |
| red   | automatic,hybrid,mp3,reliable | u.s.a./new york/syracuse   |
+-------+-------------------------------+----------------------------+
7 rows in set, 7 hits, 15000 total docs (server: 17ms, total: 44ms)
</pre>

<h4>Queries with Group By</h4>
<p>You can group the search results of a query by one
          facet, which can be a simple column or a facet built upon a
          group of columns. You can also specify how many hits you want
          to keep in each group (the default is 10).</p>

<p>Find the first 10 groups
          of cars, with 2 hits in each group:</p>
<pre class="prettyprint lang-bql">
SELECT category, city, makemodel FROM cars GROUP BY category TOP 2
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
========================================================================================
| category      | city                            | makemodel                          |
========================================================================================
| compact       | u.s.a./texas/houston            | asian/acura/tl                     |
| compact       | u.s.a./florida/tampa            | asian/acura/1.6el                  |
+---------------+---------------------------------+------------------------------------+
| exotic        | u.s.a./florida/tampa            | european/bentley/azure             |
| exotic        | u.s.a./california/san francisco | european/bentley/azure             |
+---------------+---------------------------------+------------------------------------+
| luxury        | u.s.a./florida/orlando          | asian/acura/3.5rl                  |
| luxury        | u.s.a./new york/rochester       | asian/acura/3.5rl                  |
+---------------+---------------------------------+------------------------------------+
| sports car    | u.s.a./california/sunnyvale     | asian/acura/integra                |
| sports car    | u.s.a./texas/austin             | asian/acura/integra                |
+---------------+---------------------------------+------------------------------------+
| sedan         | china/beijing                   | north american/eagle/vision        |
| sedan         | australia/perth                 | north american/eagle/vision        |
+---------------+---------------------------------+------------------------------------+
| suv           | china/shanghai                  | north american/ford/bronco         |
| suv           | u.s.a./california/sacramento    | north american/ford/bronco         |
+---------------+---------------------------------+------------------------------------+
| van           | u.s.a./florida/palm beach       | north american/ford/club wagon     |
| van           | u.s.a./new york/albany          | north american/ford/club wagon     |
+---------------+---------------------------------+------------------------------------+
| truck         | u.s.a./utah/provo               | asian/mazda/b-series               |
| truck         | australia/melbourn              | asian/isuzu/pickup                 |
+---------------+---------------------------------+------------------------------------+
| station wagon | u.s.a./texas/dallas             | north american/saturn/sw           |
| station wagon | u.s.a./california/san jose      | north american/saturn/sw           |
+---------------+---------------------------------+------------------------------------+
| mini-van      | u.s.a./texas/austin             | north american/chevrolet/astro van |
| mini-van      | u.s.a./california/san jose      | north american/chevrolet/astro van |
+---------------+---------------------------------+------------------------------------+
========================================================================================
10 groups in set, 15000 hits, 15000 total docs (server: 55ms, total: 130ms)
</pre>

<p>Find the numbers of cars
          in different categories:</p>
<pre class="prettyprint lang-bql">
SELECT category, grouphitscount FROM cars GROUP BY category top 1
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+---------------+----------------+
| category      | grouphitscount |
+---------------+----------------+
| compact       | 4169           |
| exotic        | 1902           |
| luxury        | 2735           |
| sports car    | 1494           |
| sedan         | 990            |
| suv           | 1449           |
| van           | 168            |
| truck         | 611            |
| station wagon | 186            |
| mini-van      | 869            |
+---------------+----------------+
10 rows in set, 15000 hits, 15000 total docs (server: 3ms, total: 38ms)
</pre>

<h4>Getting Facet Information Using Browse By Clause</h4>
<p>BQL is designed to support faceted search, so we have to
      make it possible to get facet information along with the search
      results. This can be done using the Browse By clause, where you
      can specify one or more facets for which you want to get the facet
      count information. For each facet in the Browse By clause, you can
      optionally include:</p>

<ul>
<li>
          <p>whether the selection is expanded (default false)</p>
        </li>
        
        <li>
          <p>the minimum number of hit counts (default 1)</p>
        </li>

        <li>
          <p>the maximum number of hit counts (default 10)</p>
        </li>

        <li>
          <p>facet ordering method ("hits" or "value") (default
          "hits")</p>
        </li>
</ul>

<p>Here is an example:</p>

<pre class="prettyprint lang-bql">
SELECT color, year, tags, price FROM cars
                                WHERE QUERY IS "cool"
                                AND tags CONTAINS ALL ("cool", "hybrid") EXCEPT ("favorite")
                                AND color in ("red")
                                ORDER BY price desc
                                LIMIT 0,10
                                BROWSE BY color(true, 1, 10, hits), year(true, 1, 10, value), price
 </pre>

 <p>Results:</p>
<pre class="prettyprint">

| color | year                 | tags                             | price                   |
+-------+----------------------+----------------------------------+-------------------------+
| red   | 00000000000000002000 | cool,hybrid,moon-roof,navigation | 00000000000000014500.00 |
| red   | 00000000000000001993 | cool,hybrid,moon-roof,navigation | 00000000000000014400.00 |
| red   | 00000000000000002002 | automatic,cool,hybrid,navigation | 00000000000000014200.00 |
| red   | 00000000000000001998 | automatic,cool,hybrid,navigation | 00000000000000012100.00 |
| red   | 00000000000000002002 | automatic,cool,hybrid,reliable   | 00000000000000011500.00 |
| red   | 00000000000000002002 | automatic,cool,hybrid,reliable   | 00000000000000011400.00 |
| red   | 00000000000000001998 | automatic,cool,hybrid,reliable   | 00000000000000011400.00 |
| red   | 00000000000000001996 | automatic,cool,hybrid,reliable   | 00000000000000011200.00 |
| red   | 00000000000000001999 | automatic,cool,hybrid,reliable   | 00000000000000011100.00 |
| red   | 00000000000000002001 | cool,hybrid,moon-roof,reliable   | 00000000000000010500.00 |
+-------+----------------------+----------------------------------+-------------------------+
10 rows in set, 59 hits, 15000 total docs (server: 337ms, total: 372ms)
+-------------+
| color       |
+-------------+
| white  (73) |
| yellow (73) |
| blue   (62) |
| silver (61) |
| red    (59) |
| green  (58) |
| gold   (53) |
| black  (52) |
+-------------+
+-----------------------+
| price                 |
+-----------------------+
| [6800 TO 9900]   (27) |
| [* TO 6700]      (21) |
| [10000 TO 13100] (8)  |
| [13200 TO 17300] (3)  |
+-----------------------+
+---------------------+
| year                |
+---------------------+
| [1993 TO 1994] (16) |
| [1995 TO 1996] (13) |
| [1997 TO 1998] (10) |
| [1999 TO 2000] (9)  |
| [2001 TO 2002] (11) |
+---------------------+
</pre>

<h4>Queries with Run-Time Facet Handler Initialization
      Parameters</h4>
<p>In a faceted search system, a run-time facet handler usually
      requires initialization parameter(s) to be provided at search time
      for each query. For example, in a search system that searches
      LinkedIn shares or Twitter tweets, one or more run-time facets
      usually require the searcher to provide his/her user Id (or user
      name) and the time when the search is performed.</p>

<p>One run-time facet may need multiple initialization
      parameters, each of which has a different name and/or a different
      data type. These parameters can be specified in the SELECT
      statement using the GIVEN FACET PARAM clause. Every parameter is
      specified in the clause as a 4-tuple,
      (<code>facet-name</code>, <code>param-name</code>,
      <code>param-type</code>,
      <code>param-value</code>).</p>

<p>On a search system for LinkedIn
          shares, find recent updates from member 12345678 himself
          (i.e. value 0 for the Network facet) and all his first degree
          connections (i.e. value 1 for the Network facet) in US:</p>

 <pre class="prettyprint lang-bql">
SELECT _uid, Network, userid, country FROM shares WHERE country = "us"
                                                  AND Network in (0, 1)
                                      GIVEN FACET PARAM (Network, "member_id", int, 12345678)
 </pre>

 <p>Results:</p>
<pre class="prettyprint">
+---------------------+---------+----------------------+---------+
| _uid                 | Network | userid               | country |
+---------------------+---------+----------------------+---------+
| 5527797854963249152 | 0       | 00000000000012345678 | us      |
| 5527805402646839296 | 1       | 00000000000042593551 | us      |
| 5527816561408086016 | 0       | 00000000000012345678 | us      |
| 5527825082430267392 | 1       | 00000000000022593551 | us      |
| 5527829323551084544 | 0       | 00000000000012345678 | us      |
| 5527848889647902720 | 1       | 00000000000004730909 | us      |
| 5527853965330358272 | 1       | 00000000000004730909 | us      |
| 5527884781573898240 | 1       | 00000000000026325826 | us      |
| 5527487070454427648 | 0       | 00000000000012345678 | us      |
| 5527488521884930048 | 0       | 00000000000012345678 | us      |
+---------------------+---------+----------------------+---------+
10 rows in set, 14 hits, 10749644 total docs (server: 432ms, total: 472ms)
</pre>