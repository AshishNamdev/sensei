<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Data Modeling</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="sensei.html" title="Sensei"><link rel="up" href="ch09.html" title="Chapter&nbsp;9.&nbsp;Sensei Configuration"><link rel="prev" href="ch09.html" title="Chapter&nbsp;9.&nbsp;Sensei Configuration"><link rel="next" href="ch09s03.html" title="System Configuration"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Data Modeling</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch09.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;9.&nbsp;Sensei Configuration</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch09s03.html">Next</a></td></tr></table><hr></div><div class="section" title="Data Modeling"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sect-data-modeling"></a>Data Modeling</h2></div></div></div><p>Data models are described in the
      <code class="filename">schema.xml</code> file.  The XSD definition of this
      XML file can be found from
      http://javasoze.github.com/sensei/schema/sensei-schema.xsd.</p><p>The schema file is composed by 2 sections:</p><div class="orderedlist"><ol class="orderedlist" type="1" compact><li class="listitem"><p>Table schema</p></li><li class="listitem"><p>Facet schema</p></li></ol></div><div class="section" title="Table Schema"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1512"></a>Table Schema<a class="indexterm" name="d0e1515"></a></h3></div></div></div><p>A Sensei instance can be viewed as a giant table with many
        columns and many rows. The concept of such table directly correlates
        to that of traditional RDBMS's.</p><p>A table may have the following attributes:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc" compact><li class="listitem"><p><span class="bold"><strong>uid</strong></span> (mandatory) -
            defines the name of the primary key field.  This must be of
            type <code class="literal">long</code>.</p></li><li class="listitem"><p><span class="bold"><strong>delete-field</strong></span>
            (optional) - defines the field that would indicate a delete
            event (we will get back to this later).</p></li><li class="listitem"><p><span class="bold"><strong>skip-field</strong></span> (optional)
            - defines the field that would indicate a skipping event (we
            will get back to this later).</p></li><li class="listitem"><p><span class="bold"><strong>src-data-store</strong></span>
            (optional) - defines the format of how the source data is
            saved.  Currently the only supported value is
            "<code class="literal">lucene</code>".</p></li><li class="listitem"><p><span class="bold"><strong>src-data-field</strong></span>
            (optional) - specifies the field name used to keep the
            original source data value.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If this attribute is not specified, the default
              value is set to "<code class="literal">src_data</code>".  If this
              field is not set by the data source filter, the string
              representation of the original data source is saved in
              this field by default.  If part of the source data or a
              modified version of the source data is to be saved in the
              index, then you need to set this field using the value you
              prefer in the data source filter.</p></div></li><li class="listitem"><p><span class="bold"><strong>compress-src-data</strong></span>
            (optional) - defines if the source data is
            compressed.</p></li></ul></div><p>A table is also composed of a set of columns.  Each column
        has a name and a type.  Below is the list of supported
        types:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc" compact><li class="listitem"><p><span class="bold"><strong>string</strong></span> - value is a
            string, e.g. "<code class="literal">abc</code>"</p></li><li class="listitem"><p><span class="bold"><strong>int</strong></span> - integer value</p></li><li class="listitem"><p><span class="bold"><strong>long</strong></span> - long value</p></li><li class="listitem"><p><span class="bold"><strong>short</strong></span> - short value</p></li><li class="listitem"><p><span class="bold"><strong>float</strong></span> - a floating point value</p></li><li class="listitem"><p><span class="bold"><strong>double</strong></span> - double value</p></li><li class="listitem"><p><span class="bold"><strong>char</strong></span> - a character</p></li><li class="listitem"><p><span class="bold"><strong>date</strong></span> - a date value,
            which must be accompanied by a format string to be used to
            parse a date string</p></li><li class="listitem"><p><span class="bold"><strong>text</strong></span> - a searchable
            text segment, standard Lucene indexing specification can
            also be specified here, e.g. <code class="literal">index="ANALYZED"</code>,
            <code class="literal">termvector="NO"</code>.</p></li></ul></div><p>A column that is not of type "text" is considered a
        <span class="emphasis"><em>meta</em></span> column.  Any meta column can be
        specified to be either <span class="emphasis"><em>single</em></span> (default) or
        <span class="emphasis"><em>multi</em></span>.  When a column is specified to be
        <span class="emphasis"><em>multi</em></span>, e.g. <code class="literal">multi="true"</code>, it
        means that, given a row, the column can have more than one
        value.  A delimited string can be provided to help the indexer
        parse the values (default delimiter is "<code class="literal">,</code>").
        To specify a different delimiter, say "<code class="literal">:</code>", we
        can simply set <code class="literal">delimiter=":"</code>)</p><p>Here is an example of the table schema (see
        https://github.com/javasoze/sensei/blob/master/conf/schema.xml):</p><pre class="programlisting">  &lt;table uid="id" delete-field="" skip-field=""&gt;
    &lt;column name="color" type="string" /&gt;
    &lt;column name="category" type="string" /&gt;
    &lt;column name="city" type="string" /&gt;
    &lt;column name="makemodel" type="string" /&gt;
    &lt;column name="year" type="int" /&gt;
    &lt;column name="price" type="float" /&gt;
    &lt;column name="mileage" type="int" /&gt;
    &lt;column name="tags" type="string" multi="true" delimiter=","/&gt;
    &lt;column name="contents" type="text" index="ANALYZED"
            store="NO" termvector="NO"/&gt;
  &lt;/table&gt;</pre><div class="section" title="JSON"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1652"></a>JSON<a class="indexterm" name="d0e1655"></a></h4></div></div></div><p>By default, data objects inserted into Sensei are JSON
          objects.</p><p><span class="bold"><strong>Example</strong></span>:</p><p>Given the following table definition:</p><pre class="programlisting">  &lt;table uid="id"&gt;
    &lt;column name="color" type="string" /&gt;
    &lt;column name="year" type="int" /&gt;
    &lt;column name=tag" type="string" multi="true" /&gt;
    &lt;column name="description" type="text" index="ANALYZED" store="NO" /&gt;
  &lt;/table&gt;
</pre><p>The following table shows as an example how a JSON
          object is mapped into the table:</p><p>
            <span class="bold"><strong>JSON object</strong></span>
          </p><pre class="programlisting">  {
    id:1
    color:"red",
    year:2000,
    tag:"cool,leather",
    description:"i love this car"
  }</pre><p>
            <span class="bold"><strong>Table view</strong></span>
          </p><table border="2" cellpadding="6" cellspacing="0" frame="hsides" rules="groups" id="d0e1682"><colgroup>
              <col align="left">

              <col align="left">

              <col align="left">

              <col align="left">

              <col align="left">
            </colgroup><thead><tr>
                <th align="left">id</th>

                <th align="left">color</th>

                <th align="left">year</th>

                <th align="left">tag</th>

                <th align="left">description</th>
              </tr></thead><tbody><tr>
                <td align="left">1</td>

                <td align="left">red</td>

                <td align="left">2000</td>

                <td align="left">cool, leather</td>

                <td align="left">i love this car</td>
              </tr></tbody></table></div><div class="section" title="Deletes"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1731"></a>Deletes<a class="indexterm" name="d0e1734"></a></h4></div></div></div><p>To delete a row from Sensei, simply insert a data object
          with the specified delete-field set to true.</p><p>
            <span class="bold"><strong>Example:</strong></span>
          </p><p>Given the table schema:</p><pre class="programlisting">  &lt;table uid="id" delete-field="isDelete"&gt;
  ...
  &lt;/table&gt;
</pre><p>The following JSON object would delete the row where
          id=5:</p><pre class="programlisting">  {
    id:5,
    isDelete:"true"
  }</pre></div><div class="section" title="Skips"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1752"></a>Skips<a class="indexterm" name="d0e1755"></a></h4></div></div></div><p>In cases where runtime logic decides whether a data object
          should be skipped, the skip field can be useful.</p><p>
            <span class="bold"><strong>Example:</strong></span>
          </p><p>Given the table schema:</p><pre class="programlisting">  &lt;table uid="id" skip-field="isSkip"&gt;
  ...
  &lt;/table&gt;</pre><p>The following JSON object would be skipped from
          indexing:</p><pre class="programlisting">  {
    id:7,
    isSkip:"true"
  }</pre></div><div class="section" title="Source JSON"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1773"></a>Source JSON<a class="indexterm" name="d0e1776"></a></h4></div></div></div><p>For many cases, you may want to save the original source
          data from which we extract all the fields into the index.  You
          can do this by setting the attributes <span class="bold"><strong>src-data-store</strong></span> and <span class="bold"><strong>src-data-field</strong></span>.</p></div></div><div class="section" title="Facet Schema"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1787"></a>Facet Schema<a class="indexterm" name="d0e1790"></a></h3></div></div></div><p>The second section is the facet schema, which defines how
        columns can be queried.</p><p>If we think of the table section defines how data is added into
        Sensei, then the facet section describes how these data can be
        queried.</p><p>The facet sections is composed of a set of facet
        definitions.</p><p>A facet definition requires a name and a type.</p><p>Possible types:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc" compact><li class="listitem"><p><span class="bold"><strong>simple</strong></span>: simplest facet, 1 row = 1 discrete
            value</p></li><li class="listitem"><p><span class="bold"><strong>path</strong></span>: hierarchical facet, e.g. a/b/c</p></li><li class="listitem"><p><span class="bold"><strong>range</strong></span>: range facet, used to support range
            queries</p></li><li class="listitem"><p><span class="bold"><strong>multi</strong></span>: 1 row = N discrete values</p></li><li class="listitem"><p><span class="bold"><strong>compact-multi</strong></span>: similar to multi, but possible
            values are limited to 32</p></li><li class="listitem"><p><span class="bold"><strong>histogram</strong></span><a class="indexterm" name="d0e1833"></a>:
            similar to a range facet, but a histogram facet
            automatically calculates the distribution of facet values
            over a predefined series of ranges with the same size. (A
            histogram facet depends on another numeric facet, and it
            requires several mandatory parameters, see <a class="xref" href="ch09s02.html#sect-histogram-parameters" title="Parameters for Histogram Facets">the section called &#8220;Parameters for Histogram Facets&#8221;</a>.</p></li><li class="listitem"><p><span class="bold"><strong>custom</strong></span>: any user defined facet type</p></li></ul></div><p>Example: <a class="link" href="https://github.com/javasoze/sensei/blob/master/conf/schema.xml" target="_top">https://github.com/javasoze/sensei/blob/master/conf/schema.xml</a></p><div class="section" title="Optional Attributes"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1848"></a>Optional Attributes<a class="indexterm" name="d0e1851"></a></h4></div></div></div><div class="section" title="Column"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1854"></a>Column<a class="indexterm" name="d0e1857"></a></h5></div></div></div><p>The column attribute references the column names
            defined in the table section. By default, the value of the
            <code class="literal">name</code> attribute is used.</p><p>This can be useful if you want to name the facet name to be
            different from the defined column name, or if you want to have
            multiple facets defined on the same column.</p></div><div class="section" title="Depends"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1869"></a>Depends<a class="indexterm" name="d0e1872"></a></h5></div></div></div><p>This is a comma delimited string denoting a set of
            facet names this facet is to be depended on.</p><p>When attribute <code class="literal">depends</code> is specified,
            Sensei guarantees that the depended facets are loaded before
            this facet.</p><p>This is also how Composite Facets are constructed.
            (Another advanced topic).</p></div><div class="section" title="Dynamic"><div class="titlepage"><div><div><h5 class="title"><a name="d0e1886"></a>Dynamic<a class="indexterm" name="d0e1889"></a></h5></div></div></div><p>Dynamic facets are useful when data layout is not known
            until query time.</p><p>Some examples:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc" compact><li class="listitem"><p>Searcher's social network</p></li><li class="listitem"><p>Dynamic time ranges from when the search request is
                issued</p></li></ul></div><p>This is another advanced topic to be discussed later.</p></div></div><div class="section" title="Parameters"><div class="titlepage"><div><div><h4 class="title"><a name="sect-facet-parameters"></a>Parameters</h4></div></div></div><p>A facet can be configured via a list of parameters.
          Parameters are needed for a facet under some situations, for
          example:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc" compact><li class="listitem"><p>For path facets, separator strings can be
              configured</p></li><li class="listitem"><p>For range facets, predefined ranges can be
              configured</p></li></ul></div><p>The parameters can be specified via element
          <code class="literal">params</code>, which contains a list of elements called
          <code class="literal">param</code>.  For each <code class="literal">param</code>, two
          attributes need to be specified: <code class="literal">name</code> and
          <code class="literal">value</code>.</p><p>How parameters are interpreted and used is dependent on
          the facet type.</p><p>Here is an example of a facet with a list of predefined
          ranges: </p><pre class="programlisting">  &lt;facet name="year" type="range"&gt;
    &lt;params&gt;
      &lt;param name="range" value="1993-1994"/&gt;
      &lt;param name="range" value="1995-1996"/&gt;
      &lt;param name="range" value="1997-1998"/&gt;
      &lt;param name="range" value="1999-2000"/&gt;
      &lt;param name="range" value="2001-2002"/&gt;
    &lt;/params&gt;
  &lt;facet&gt;</pre><div class="section" title="Parameters for Histogram Facets"><div class="titlepage"><div><div><h5 class="title"><a name="sect-histogram-parameters"></a>Parameters for Histogram Facets</h5></div></div></div><p>A histogram facet requires 5 parameters:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>datatype</strong></span>: the
                data type.  Only the following 5 numeric data types are
                allowed:</p><div class="orderedlist"><ol class="orderedlist" type="1" compact><li class="listitem"><p>int</p></li><li class="listitem"><p>short</p></li><li class="listitem"><p>long</p></li><li class="listitem"><p>float</p></li><li class="listitem"><p>double</p></li></ol></div></li><li class="listitem"><p><span class="bold"><strong>datahandler</strong></span>: this
                is the name of the facet that the histogram facet
                depends on.  The values of this facet are used to
                generate the distribution information.</p></li><li class="listitem"><p><span class="bold"><strong>start</strong></span>: the
                minimum value of the facet.</p></li><li class="listitem"><p><span class="bold"><strong>end</strong></span>: the maximum
                value of the facet.</p></li><li class="listitem"><p><span class="bold"><strong>unit</strong></span>: the unit
                value used to divide facet values into ranges.</p></li></ul></div><p>Here is an example configuration for a histogram facet
            over a facet called <code class="literal">score</code>:</p><pre class="programlisting">  &lt;facet name="scoreHistogram" type="histogram"&gt;
    &lt;params&gt;
      &lt;param name="datatype" value="int"/&gt;
      &lt;param name="datahandler" value="score"/&gt;
      &lt;param name="start" value="0"/&gt;
      &lt;param name="end" value="100"/&gt;
      &lt;param name="unit" value="10"/&gt;
    &lt;/params&gt;
  &lt;/facet&gt;</pre></div></div><div class="section" title="Customized Facets"><div class="titlepage"><div><div><h4 class="title"><a name="d0e1996"></a>Customized Facets</h4></div></div></div><p>We understand we cannot possibly cover all use cases
          using a short list of predefined facet handlers.  It is
          necessary to allow users to define their own customized facets
          for different reasons.</p><p>If a customized facet handler is required for a column
          (or multiple columns), you can set the facet type to
          "<code class="literal">custom</code>", and declare a bean for the facet
          handler in file <code class="filename">custom-facets.xml</code>.</p><p>For example, if a customized facet called
          <code class="literal">time</code> is declared in
          <code class="filename">schema.xml</code> like this: </p><pre class="programlisting">  &lt;facet name="time" type="custom" dynamic="false"/&gt;</pre><p>and the implementation of the facet handler is in class
          <code class="literal">com.example.facets.TimeFacetHandler</code>, then you
          should include the following line in file
          <code class="filename">custom-facets.xml</code>: <sup>[<a name="d0e2027" href="#ftn.d0e2027" class="footnote">1</a>]</sup>
          </p><pre class="programlisting">  &lt;bean id="time" class="com.example.facets.TimeFacetHandler"/&gt;</pre><p>The id of the bean should match the name of the
          facet.</p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e2027" href="#d0e2027" class="para">1</a>] </sup>Here we assume that the time facet handler does not take
          any arguments. </p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch09.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch09.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch09s03.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;9.&nbsp;Sensei Configuration&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="sensei.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;System Configuration</td></tr></table></div></body></html>